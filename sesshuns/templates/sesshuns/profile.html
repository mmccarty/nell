{% extends "sesshuns/base.html" %}
{% load custom %}
{% block title %}Profile - {{u|display_name}} {% endblock %}
{% block content %}
      <div id="header" class="span-24 last">
        <h1>{{u|display_name}}</h1>
      </div>
      <div id="subheader" class="span-24 last">
        <!-- Add affiliation here. -->
        <hr />
      </div>
      <div class="span-17 colborder" id="content">
        <h3 class="loud">Projects</h3>
        <div>
          <table>
            <tr>
              <th>Project ID</th>
              <th>Title</th>
            </tr>
              {% for i in u.investigator_set.all %}
                <tr>
                  <td><a href="/project/{{i.project.pcode}}">{{i.project.pcode}}</a></td>
                  <td>{{i.project.name}}</td>
                </tr>
              {% endfor %}
          </table>
          {% if u.project_set.all %}
            <h3 class="loud">Project Friend On</h3>
              <table>
                <tr>
                  <th>Project ID</th>
                  <th>Title</th>
                </tr>
                  {% for p in u.project_set.all %}
                    <tr>
                      <!-- if u not in p.investigator_set.user
                           (not possible as template, nor important -->
                      <td><a href="/project/{{p.pcode}}">{{p.pcode}}</a></td>
                      <td>{{p.name}}</td>
                    </tr>
                  {% endfor %}
              </table>
          {% endif %}
          <hr />
        </div>
        <div class="span-8 colborder">  
          <h3 class="loud">Dynamic Contact Information</h3>
          <p>{{u.contact_instructions|escape|linebreaks}}</p>
          {% if authorized or requestor.isAdmin %}
          <a href="/profile/{{u.id}}/dynamic_contact/form">edit</a>
          {% endif %}
        </div>  
        <div class="span-8 last">  
          <h3 class="loud">Static Contact Information</h3>  
          <em>To update, edit your profile at <a href="https://my.nrao.edu">my.nrao.edu</a></em>
          <table>
            <tr>
              <th>Email(s)</th>
            </tr>
              {% for e in emails %}
                <tr>
                  <td>{{e}}</td>
                </tr>
              {% endfor %}
          </table>
          <table>
            <tr>
              <th>Phone(s)</th>
            </tr>
              {% for p in phones %}
                <tr>
                  <td>{{p}}</td>
                </tr>
              {% endfor %}
          </table>
          <table>
            <tr>
              <th>Postal Address(es)</th>
            </tr>
              {% for pt in postals %}
                <tr>
                  <td>{{pt}}</td>
                </tr>
              {% endfor %}
          </table>
          <table>
            <tr>
              <th>Affiliation(s)</th>
            </tr>
              {% for a in affiliations %}
                <tr>
                  <td>{{a}}</td>
                </tr>
              {% endfor %}
          </table>

        </div>
        <hr />
        <div>
          <h3 class="loud">Blackout Dates (UTC)</h3>
          <table>
            <tr>
              <th>Begin</th>
              <th>End</th>
              <th>Repeat</th>
              <th>Until</th>
              <th>Description</th>
            </tr>
            {% for b in u.blackout_set.all %}
            <tr>
              <td>{{b.start_date|date:'j M Y H:i'}}</td>
              <td>{{b.end_date|date:'j M Y H:i'}}</td>
              <td>{{b.repeat.repeat}}</td>
              {% if b.until %}
              <td>{{b.until|date:'j M Y H:i'}}</td>
              {% else %}
              <td>{{b.until|pretty_none}}</td>
              {% endif %}
              <td>{{b.description}}</td>
            {% if authorized or requestor.isAdmin %}
              <td>
                <a href="/profile/{{u.id}}/blackout/form?_method=PUT&id={{b.id}}">edit</a> |
                <a href="/profile/{{u.id}}/blackout?_method=DELETE&id={{b.id}}">delete</a>
              </td>
            {% endif %}
            </tr>
            {% endfor %}
          </table>
          {% if authorized or requestor.isAdmin %}
          <a href="/profile/{{u.id}}/blackout/form">add</a>
          {% endif %}
          <br/>
          <br/>
          <br/>
        </div>
      </div>
      <div class="span-6 last" id="sidebar">
        <div id="periods">
          <h3 class="caps">Upcoming Observations</h3>
          <div class="box">
            <ul>
            {% for proj, pds in u.getUpcomingPeriodsByProject.items %}
              {% if pds %}
              <li title="{{proj.pcode}}">{{proj.pcode}}</li>
                <ul>
                  {% for pd in pds %}
                    <li title="{{pd.session.name}}: {{pd.start|date:'Y-m-d H:i'}} UTC for {{pd.duration|hrs2sex}} hrs">
                    {{pd.session.name}}: {{pd.start|date:"D, M d H:i"}} UTC for {{pd.duration|hrs2sex}} hrs
                    </li>
                  {% endfor %}
                </ul>
              </li>
              {% endif %}
            {% endfor %}
            </ul>
          </div>
        </div>
        <div id="reservation">
          <h3 class="caps">Upcoming Reservations</h3>
          <div class="box">
          <table>
            <tr>
              <th>check-in</th>
              <th>check-out</th>
            </tr>
              {% for r in reserves %}
                <tr>
                  <td title="{{r.0|date:'m/d/Y'}}">
                    {{ r.0|date:"D, M d" }}
                  </td>
                  <td title="{{r.1|date:'m/d/Y'}}">
                    {{ r.1|date:"D, M d" }}
                  </td>
                </tr>
              {% endfor %}
          </table>
          </div>
        </div>
      </div>
{% endblock %}
